<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prot√≥tipo S&OP Inteligente</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="./styles/main.css">
  <link rel="stylesheet" href="./styles/vieses.css">
  <link rel="stylesheet" href="./styles/ai-insights.css">
  <link rel="stylesheet" href="./styles/demanda.css">
  <link rel="stylesheet" href="./styles/onboarding.css">
</head>
<body>
  <div class="navbar">
    <div class="logo">
      <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="8" height="24" rx="2" fill="#2e7d4f"/><rect x="12" y="8" width="8" height="18" rx="2" fill="#4caf50"/><rect x="22" y="14" width="4" height="12" rx="2" fill="#a5d6a7"/></svg>
      S&OP
    </div>
    <nav id="main-nav">
      <a href="javascript:void(0)" class="active" data-tab="visao-geral">Vis√£o Geral</a>
      <a href="javascript:void(0)" data-tab="vieses">Vieses</a>
      <a href="javascript:void(0)" data-tab="previsao">Previs√£o</a>
      <a href="javascript:void(0)" data-tab="otimizacao">Otimiza√ß√£o</a>
      <button id="resetTour" class="nav-reset-btn" title="Reiniciar Tour">üîÑ Tour</button>
    </nav>
    <div class="user">
      <svg width="22" height="22" fill="none" stroke="#fff" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 16-4 16 0"/></svg>
      <span>usu√°rio</span>
    </div>
  </div>
  <div class="navbar-placeholder"></div>
  <div class="container">
    <div class="filters">
      <select>
        <option>Abr - Jun 2024</option>
        <option>Jan - Mar 2024</option>
        <option>Out - Dez 2023</option>
      </select>
      <!-- √çcone de simula√ß√£o IA -->
      <span id="icone-simular-ia" class="ai-help-trigger" data-modulo="simulacao" style="cursor:pointer; margin-left:1.2rem; vertical-align:middle; display:inline-flex; align-items:center; gap:0.5rem;" title="Simular Cen√°rio com IA">
        <svg class="ai-help-icon" width="32" height="32" viewBox="0 0 64 64" fill="none">
          <rect x="12" y="20" width="40" height="28" rx="14" fill="#2563eb"/>
          <circle cx="32" cy="16" r="7" fill="#60a5fa"/>
          <circle cx="22" cy="36" r="4" fill="#fff"/>
          <circle cx="42" cy="36" r="4" fill="#fff"/>
          <rect x="28" y="46" width="8" height="3" rx="1.5" fill="#60a5fa"/>
        </svg>
        <span style="font-weight:600; color:#2563eb; font-size:1.08em;">Simulador de Cen√°rio com IA</span>
      </span>
    </div>
    <!-- Vis√£o Geral -->
    <div class="tab-content tab-visao-geral">
      <div class="indicators">
        <div class="indicator"><strong>91 %</strong><span>Acur√°cia Geral de Previs√£o</span></div>
        <div class="indicator"><strong>85 %</strong><span>% de Stockouts Evitados</span></div>
        <div class="indicator"><strong>R$ 120 K</strong><span>Economia com Otimiza√ß√£o</span></div>
      </div>
      <div class="dashboard">
        <!-- Card 1: Vieses dos Gerentes -->
        <div class="card">
          <div class="card-title">
            <span class="ai-help-trigger" data-modulo="vieses">
              <svg class="ai-help-icon" viewBox="0 0 40 40" fill="none">
                <rect x="7" y="13" width="26" height="16" rx="8" fill="#2563eb"/>
                <circle cx="20" cy="11" r="5" fill="#60a5fa"/>
                <circle cx="14" cy="23" r="3" fill="#fff"/>
                <circle cx="26" cy="23" r="3" fill="#fff"/>
                <rect x="17" y="28" width="6" height="2.5" rx="1.2" fill="#60a5fa"/>
              </svg>
            </span>
            <span>Identifica√ß√£o de Vieses dos Gerentes</span>
          </div>
          <table>
            <thead>
              <tr><th>Gerentes</th><th>Perfil</th><th></th></tr>
            </thead>
            <tbody>
              <tr><td>Ana</td><td>Pessimista</td><td><span class="details-link" data-gerente="Ana" title="Ver gr√°fico do perfil"><svg width="22" height="22" fill="none" stroke="#2563eb" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 16v-4m4 4V8m4 8v-2"/></svg></span></td></tr>
              <tr><td>Jo√£o</td><td>Otimista Estrat√©gico</td><td><span class="details-link" data-gerente="Jo√£o" title="Ver gr√°fico do perfil"><svg width="22" height="22" fill="none" stroke="#2563eb" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 16v-4m4 4V8m4 8v-2"/></svg></span></td></tr>
              <tr><td>Maria</td><td>Pessimista</td><td><span class="details-link" data-gerente="Maria" title="Ver gr√°fico do perfil"><svg width="22" height="22" fill="none" stroke="#2563eb" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 16v-4m4 4V8m4 8v-2"/></svg></span></td></tr>
              <tr><td>Pedro</td><td>Otimista</td><td><span class="details-link" data-gerente="Pedro" title="Ver gr√°fico do perfil"><svg width="22" height="22" fill="none" stroke="#2563eb" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M8 16v-4m4 4V8m4 8v-2"/></svg></span></td></tr>
            </tbody>
          </table>
          <div style="margin-top:1.5rem;">
            <canvas id="viesesBarChart" height="180"></canvas>
          </div>
        </div>
        <!-- Card 2: Previs√£o de Demanda e Estoque -->
        <div class="card">
          <div class="card-title">
            <span class="ai-help-trigger" data-modulo="previsao">
              <svg class="ai-help-icon" viewBox="0 0 40 40" fill="none">
                <rect x="7" y="13" width="26" height="16" rx="8" fill="#2563eb"/>
                <circle cx="20" cy="11" r="5" fill="#60a5fa"/>
                <circle cx="14" cy="23" r="3" fill="#fff"/>
                <circle cx="26" cy="23" r="3" fill="#fff"/>
                <rect x="17" y="28" width="6" height="2.5" rx="1.2" fill="#60a5fa"/>
              </svg>
            </span>
            <span>Previs√£o de Demanda e Estoque</span>
          </div>
          <div style="margin-bottom:0.5rem;">
            <select style="font-size:0.98em; padding:0.2em 0.7em; border-radius:6px; border:1px solid var(--gray);">
              <option>Cluster de Produto</option>
            </select>
          </div>
          <canvas id="graficoVisaoGeral" class="chart-area" height="120"></canvas>
          <div style="display:flex; gap:1.2rem; font-size:0.95em; color:var(--text-muted); margin-bottom:0.5rem;">
            <span style="color:#2e7d4f; font-weight:600;">Hist√≥rico</span>
            <span style="color:#4caf50; font-weight:600;">Demanda</span>
            <span style="color:#a5d6a7; font-weight:600;">Invent√°rio</span>
          </div>
          <table>
            <thead>
              <tr><th>Modelos Testados</th><th>Erro Absoluto</th></tr>
            </thead>
            <tbody>
              <tr><td>ARIMA</td><td>280</td></tr>
              <tr><td>GAMLSS</td><td>300</td></tr>
              <tr><td>Exponencial</td><td>380</td></tr>
            </tbody>
          </table>
          <button class="btn export-btn">Exportar CSV</button>
        </div>
        <!-- Card 3: Otimiza√ß√£o de Ressuprimento -->
        <div class="card">
          <div class="card-title">
            <span class="ai-help-trigger" data-modulo="otimizacao">
              <svg class="ai-help-icon" viewBox="0 0 40 40" fill="none">
                <rect x="7" y="13" width="26" height="16" rx="8" fill="#2563eb"/>
                <circle cx="20" cy="11" r="5" fill="#60a5fa"/>
                <circle cx="14" cy="23" r="3" fill="#fff"/>
                <circle cx="26" cy="23" r="3" fill="#fff"/>
                <rect x="17" y="28" width="6" height="2.5" rx="1.2" fill="#60a5fa"/>
              </svg>
            </span>
            <span>Otimiza√ß√£o de Ressuprimento</span>
          </div>
          <div style="margin-bottom:0.5rem;">
            <select style="font-size:0.98em; padding:0.2em 0.7em; border-radius:6px; border:1px solid var(--gray);">
              <option>Cluster Rot</option>
            </select>
          </div>
          <canvas id="graficoBarraVisaoGeral" class="bar-chart" height="120"></canvas>
          <div style="display:flex; gap:1.2rem; font-size:0.95em; color:var(--text-muted); margin-bottom:0.5rem;">
            <span style="color:#2e7d4f; font-weight:600;">Cen√°rio</span>
            <span style="color:#a5d6a7; font-weight:600;">Cen√°rio Otimizado</span>
          </div>
          <div style="font-size:0.98em; color:var(--text-light); margin-bottom:0.7rem;">
            Reduzir cobertura de <b>98</b> para <b>60 dias</b> em cluster XY2 reduz em <b>R$ 35 mil</b>
          </div>
          <button class="btn">Aprovar Cen√°rio</button>
        </div>
      </div>
      <!-- Card extra: Previs√£o de Demanda -->
      <div class="dashboard" style="grid-template-columns: 1fr; gap: 1.5rem;">
        <div class="card demanda-card">
          <div class="demanda-title-row">
            <span class="demanda-title">
              <span class="ai-help-trigger" data-modulo="previsao">
                <svg class="ai-help-icon" viewBox="0 0 40 40" fill="none">
                  <rect x="7" y="13" width="26" height="16" rx="8" fill="#2563eb"/>
                  <circle cx="20" cy="11" r="5" fill="#60a5fa"/>
                  <circle cx="14" cy="23" r="3" fill="#fff"/>
                  <circle cx="26" cy="23" r="3" fill="#fff"/>
                  <rect x="17" y="28" width="6" height="2.5" rx="1.2" fill="#60a5fa"/>
                </svg>
              </span>
              Previs√£o de Demanda
            </span>
            <span class="details-link">Ver Detalhes</span>
          </div>
          <div class="demanda-impact-graph">
            <canvas id="demandaChart" height="220"></canvas>
          </div>
          <div>Cluster de Produto</div>
          <div class="demanda-indicadores-row">
            <div class="demanda-indicador">
              <span class="demanda-indicador-label">Tempo de Resposta</span>
              7 days
            </div>
            <div class="demanda-indicador">
              <span class="demanda-indicador-label">Custo do Pedido</span>
              R$ 200
            </div>
            <div class="demanda-indicador">
              <span class="demanda-indicador-label">Custo de Armazenagem</span>
              R$ 130
            </div>
            <div class="demanda-indicador">
              <span class="demanda-indicador-label">Demanda Prevista</span>
              1000
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Vieses -->
    <div class="tab-content tab-vieses" style="display:none;">
      <div class="vieses-flex">
        <div class="vieses-tabela">
          <div style="display:flex; gap:1rem; margin-bottom:1rem;">
            <select id="filtro-periodo-vieses" style="padding:0.4em 1.2em; border-radius:8px; border:1px solid #e0e0e0;">
              <option>Trimestre</option>
              <option>Semestre</option>
              <option>Ano</option>
            </select>
            <select id="filtro-cluster-vieses" style="padding:0.4em 1.2em; border-radius:8px; border:1px solid #e0e0e0;">
              <option>Cluster de Produto</option>
              <option>Cluster A</option>
              <option>Cluster B</option>
            </select>
          </div>
          <table>
            <thead>
              <tr><th>Gerente</th><th>Perfil Fuzzy</th><th>Grau de Certeza</th><th>√öltima-Atualiza√ß√£o</th><th></th></tr>
            </thead>
            <tbody id="tbody-vieses">
              <!-- preenchido via JS -->
            </tbody>
          </table>
        </div>
        <div class="vieses-cards">
          <div class="vieses-card">
            <div class="radar-title">Previs√£o Acima/Abaixo</div>
            <canvas id="graficoRadarVieses" class="radar-svg" width="220" height="220"></canvas>
          </div>
          <div class="vieses-card">
            <div class="exp-title">Explica√ß√£o</div>
            <div id="explicacao-vieses" class="exp-text">Selecione um gerente para ver detalhes.</div>
            <div class="feedback-row">
              <span>Esse perfil faz sentido?</span>
              <button id="btn-like">üëç</button>
              <button id="btn-dislike">üëé</button>
            </div>
            <button class="btn export-btn" style="margin-top:0.7rem;">Exportar Relat√≥rio</button>
          </div>
        </div>
      </div>
      <div class="vieses-actions">
        <button class="btn" id="btn-recalcular">Recalcular Perfil</button>
        <button class="btn export-btn">Exportar Relat√≥rio</button>
      </div>
    </div>
    <!-- Previs√£o -->
    <div class="tab-content tab-previsao" style="display:none;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.2rem;">
        <select style="padding:0.4em 1.2em; border-radius:8px; border:1px solid #e0e0e0; font-size:1.05em;">
          <option>Cluster de Produto</option>
          <option>Cluster A</option>
          <option>Cluster B</option>
        </select>
        <span style="font-size:1.7rem; font-weight:700; margin:auto; text-align:center; flex:1; color:#232323;">Demanda & Estoque</span>
        <span style="width:180px;"></span>
      </div>
      <div class="dashboard" style="grid-template-columns: 2fr 1fr 1fr; gap:1.5rem;">
        <!-- Sele√ß√£o de Modelo -->
        <div class="card" style="grid-column:1/2;">
          <div style="display:flex; gap:0.7rem; margin-bottom:1rem;">
            <button class="btn" style="background:#e5e7eb; color:#232323;">Melhor Modelo</button>
            <button class="btn">ARIMA</button>
            <button class="btn">SARIMA</button>
            <button class="btn">LSTM</button>
            <button class="btn">Ca√≥tico</button>
          </div>
          <div style="margin-bottom:0.7rem;">
            <label>Configura√ß√£o do Modelo Selecionado:</label>
            <select style="margin-left:0.5em;">
              <option>ARIMA</option>
              <option>SARIMA</option>
              <option>LSTM</option>
            </select>
          </div>
          <div style="margin-bottom:0.7rem;">
            <label>Explica√ß√£o do Modelo Selecionado:</label>
            <div style="font-size:0.97em; color:#555; margin-top:0.3em;">Modelo preditivo premium, melhor absolvi√ß√£o de padr√µes com baixa sazonalidade e dispers√£o estrat√©gica.</div>
          </div>
        </div>
        <!-- Gr√°fico de Previs√£o -->
        <div class="card" style="grid-column:2/3;">
          <div class="section-title">Previs√£o de Demanda
            <span class="ai-help-trigger" data-modulo="previsao">
              <svg class="ai-help-icon" viewBox="0 0 40 40" fill="none">
                <rect x="7" y="13" width="26" height="16" rx="8" fill="#2563eb"/>
                <circle cx="20" cy="11" r="5" fill="#60a5fa"/>
                <circle cx="14" cy="23" r="3" fill="#fff"/>
                <circle cx="26" cy="23" r="3" fill="#fff"/>
                <rect x="17" y="28" width="6" height="2.5" rx="1.2" fill="#60a5fa"/>
              </svg>
            </span>
          </div>
          <canvas id="graficoVisaoGeral" class="chart-area" height="120"></canvas>
          <div style="display:flex; gap:1.2rem; font-size:0.95em; color:var(--text-muted); margin-bottom:0.5rem;">
            <span style="color:#232323; font-weight:600;">Atual</span>
            <span style="color:#888; font-weight:600;">Intervalo de Confian√ßa</span>
          </div>
        </div>
        <!-- Compara√ß√£o dos Modelos -->
        <div class="card" style="grid-column:3/4;">
          <div class="section-title">Compara√ß√£o dos Modelos</div>
          <table>
            <thead>
              <tr><th>Modelo</th><th>Erro</th><th>Erro %</th></tr>
            </thead>
            <tbody>
              <tr><td>ARIMA</td><td>320</td><td>5%</td></tr>
              <tr><td>GAMLSS</td><td>410</td><td>11%</td></tr>
              <tr><td>LSTM</td><td>238</td><td>19%</td></tr>
            </tbody>
          </table>
          <div style="display:flex; gap:0.7rem; margin-top:0.7rem;">
            <button class="btn">Recalcular</button>
            <button class="btn">Fixar</button>
          </div>
        </div>
        <!-- Recomenda√ß√µes Inteligentes -->
        <div class="card" style="grid-column:1/2;">
          <div class="section-title">Recomenda√ß√µes Inteligentes</div>
          <div style="font-size:0.98em; color:#555; margin-bottom:0.7rem;">Reduzir cobertura cluster de BB para 7 dias, plano t√°tico minimiza risco de m√≠nimo n√≠vel de servi√ßo.</div>
        </div>
        <!-- Recomenda√ß√µes Integrantes -->
        <div class="card" style="grid-column:1/2;">
          <div class="section-title">Recomenda√ß√µes Integrantes</div>
          <div style="font-size:0.98em; color:#555; margin-bottom:0.7rem;">Ajustar obsolesc√™ncia e perdas de estoque de sib/re para R$ 23.600 /s</div>
        </div>
        <!-- Simulador de Impacto -->
        <div class="card" style="grid-column:3/4;">
          <div class="section-title">Simulador de Impacto</div>
          <label>Altera√ß√£o na Sazonalidade <input type="range" min="0" max="100" value="50"></label>
          <label>Aumento de Pre√ßo <input type="range" min="0" max="100" value="0"></label>
          <label>Promo√ß√£o Futura <input type="range" min="0" max="100" value="0"></label>
        </div>
        <!-- Hist√≥rico de Previs√£o -->
        <div class="card" style="grid-column:3/4;">
          <div class="section-title">Hist√≥rico de Previs√£o</div>
          <ul style="font-size:0.98em; color:var(--text-muted);">
            <li>7 abr - ARIMA - 91% acur√°cia</li>
            <li>18 mar - GAMLSS - 89% acur√°cia</li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Otimiza√ß√£o -->
    <div class="tab-content tab-otimizacao" style="display:none;">
      <div class="dashboard" style="grid-template-columns: 1fr;">
        <div class="card">
          <div class="card-title">
            <span class="ai-help-trigger" data-modulo="otimizacao">
              <svg class="ai-help-icon" viewBox="0 0 40 40" fill="none">
                <rect x="7" y="13" width="26" height="16" rx="8" fill="#2563eb"/>
                <circle cx="20" cy="11" r="5" fill="#60a5fa"/>
                <circle cx="14" cy="23" r="3" fill="#fff"/>
                <circle cx="26" cy="23" r="3" fill="#fff"/>
                <rect x="17" y="28" width="6" height="2.5" rx="1.2" fill="#60a5fa"/>
              </svg>
            </span>
            <span>Otimiza√ß√£o de Ressuprimento</span>
          </div>
          <canvas id="graficoBarraOtimizacao" class="bar-chart" height="120"></canvas>
          <div style="display:flex; gap:1.2rem; font-size:0.95em; color:var(--text-muted); margin-bottom:0.5rem;">
            <span style="color:#2e7d4f; font-weight:600;">Cen√°rio</span>
            <span style="color:#a5d6a7; font-weight:600;">Cen√°rio Otimizado</span>
          </div>
          <div style="font-size:0.98em; color:var(--text-light); margin-bottom:0.7rem;">
            Reduzir cobertura de <b>98</b> para <b>60 dias</b> em cluster XY2 reduz em <b>R$ 35 mil</b>
          </div>
          <button class="btn">Aprovar Cen√°rio</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal AI Insights flutuante -->
  <div id="aiInsightsModal" class="ai-insights-modal">
    <svg class="ai-robot-icon" viewBox="0 0 64 64" fill="none">
      <rect x="12" y="20" width="40" height="28" rx="14" fill="#5A6A7A"/>
      <circle cx="32" cy="16" r="7" fill="#A3A9B8"/>
      <circle cx="22" cy="36" r="4" fill="#fff"/>
      <circle cx="42" cy="36" r="4" fill="#fff"/>
      <rect x="28" y="46" width="8" height="3" rx="1.5" fill="#A3A9B8"/>
    </svg>
    <div class="ai-insights-content">
      <div class="ai-insights-header">
        ü§ñ AI Insights
        <button class="ai-close-btn" id="closeAiInsights" title="Fechar">‚Äì</button>
      </div>
      <span>LSTM foi o modelo mais preciso neste ciclo.</span>
    </div>
  </div>

  <!-- Modal Gen√©rico para Ver Detalhes -->
  <div id="detalhesModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(40,40,60,0.35); z-index:5000; align-items:center; justify-content:center;">
    <div id="detalhesModalBox" style="background:#fff; border-radius:18px; box-shadow:0 8px 48px #5A6A7A33; padding:2.2rem 2.5rem; min-width:320px; max-width:90vw; position:relative;">
      <button id="fecharDetalhesModal" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.7rem; color:#888; cursor:pointer;">√ó</button>
      <div id="detalhesModalConteudo">Carregando...</div>
    </div>
  </div>

  <!-- Modal Radar Vieses Gerente -->
  <div id="modalRadarVieses" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(40,40,60,0.35); z-index:5100; align-items:center; justify-content:center;">
    <div style="background:#fff; border-radius:18px; box-shadow:0 8px 48px #5A6A7A33; padding:2.2rem 2.5rem; min-width:320px; max-width:90vw; position:relative;">
      <button id="fecharModalRadarVieses" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.7rem; color:#888; cursor:pointer;">√ó</button>
      <h2>Perfil Fuzzy do Gerente</h2>
      <canvas id="radarViesesChart" width="320" height="320"></canvas>
      <div id="radarViesesInfo" style="margin-top:1.2rem; color:#555; font-size:1.05em;"></div>
    </div>
  </div>

  <!-- Modal Simula√ß√£o de Cen√°rio IA -->
  <div id="modalSimulacaoIA" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(40,40,60,0.35); z-index:5200; align-items:center; justify-content:center;">
    <div id="modalSimulacaoIABox" style="background:#fff; border-radius:18px; box-shadow:0 8px 48px #5A6A7A33; padding:2.2rem 2.5rem; min-width:340px; max-width:90vw; position:relative; text-align:left;">
      <button id="fecharModalSimulacaoIA" style="position:absolute; top:18px; right:18px; background:none; border:none; font-size:1.7rem; color:#888; cursor:pointer;">√ó</button>
      <div style="display:flex; align-items:center; gap:1.1rem; margin-bottom:1.2rem;">
        <svg width="38" height="38" viewBox="0 0 64 64" fill="none"><rect x="12" y="20" width="40" height="28" rx="14" fill="#2563eb"/><circle cx="32" cy="16" r="7" fill="#60a5fa"/><circle cx="22" cy="36" r="4" fill="#fff"/><circle cx="42" cy="36" r="4" fill="#fff"/><rect x="28" y="46" width="8" height="3" rx="1.5" fill="#60a5fa"/></svg>
        <h2 style="margin:0; color:#2563eb; font-size:1.35em;">Simula√ß√£o de Cen√°rio com IA</h2>
      </div>
      <div style="font-size:1.08em; color:#232323;">
        <b>Resultado da Simula√ß√£o:</b><br>
        <ul style='margin:0.7em 0 0.7em 1.2em;'>
          <li>Estoque de acess√≥rios <b>+20%</b></li>
          <li>Risco de ruptura cai de <b>12%</b> para <b>4%</b></li>
          <li>Custo de estoque aumenta em <b>R$ 3.000</b></li>
          <li>Vendas adicionais previstas: <b>+180 pe√ßas</b></li>
        </ul>
        <i style='color:#2563eb;'>IA recomenda refor√ßo para a cole√ß√£o Ver√£o 2024, priorizando lojas de alto giro.</i>
      </div>
    </div>
  </div>

  <script src="js/charts.js"></script>
  <script src="js/ai-insights.js"></script>
  <script src="js/demanda.js"></script>
  <script src="js/onboarding.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Navega√ß√£o por abas (menu superior)
      const navLinks = document.querySelectorAll('#main-nav a');
      const tabContents = document.querySelectorAll('.tab-content');
      
      navLinks.forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const tab = this.getAttribute('data-tab');
          
          // Remove active class from all links
          navLinks.forEach(l => l.classList.remove('active'));
          // Add active class to clicked link
          this.classList.add('active');
          
          // Hide all tab contents
          tabContents.forEach(content => {
            content.style.display = 'none';
          });
          
          // Show selected tab content
          const selectedTab = document.querySelector('.tab-' + tab);
          if (selectedTab) {
            selectedTab.style.display = '';
          }
          
          // Render specific content if needed
          if (tab === 'previsao') {
            renderPrevisao();
            setTimeout(renderDemandaChart, 100);
          }
        });
      });

      // Modal AI Insights
      const aiModal = document.getElementById('aiInsightsModal');
      const closeBtn = document.getElementById('closeAiInsights');
      let minimized = false;

      function minimizeAiModal() {
        aiModal.classList.add('minimized');
        minimized = true;
      }

      function maximizeAiModal() {
        aiModal.classList.remove('minimized');
        minimized = false;
      }
      window.maximizeAiModal = maximizeAiModal;

      // Eventos do modal AI
      closeBtn.onclick = function(e) {
        e.stopPropagation();
        minimizeAiModal();
      };

      aiModal.onclick = function(e) {
        if (minimized) {
          maximizeAiModal();
        }
      };

      // Eventos dos √≠cones de ajuda
      document.querySelectorAll('.ai-help-trigger').forEach(el => {
        el.onclick = function(e) {
          e.stopPropagation();
          const modulo = this.dataset.modulo;
          const mensagens = {
            vieses: 'Identifica√ß√£o de vieses dos gerentes usando l√≥gica fuzzy e an√°lise de padr√µes de decis√£o.',
            previsao: 'Previs√£o de demanda utilizando modelos estat√≠sticos e machine learning.',
            otimizacao: 'Otimiza√ß√£o de ressuprimento com programa√ß√£o linear e simula√ß√£o de cen√°rios.',
            simulacao: `<b>Simula√ß√£o de Cen√°rio com IA</b><br><br>
              <b>Resultado da Simula√ß√£o:</b><br>
              <ul style='margin:0.7em 0 0.7em 1.2em;'>
                <li>Estoque de acess√≥rios <b>+20%</b></li>
                <li>Risco de ruptura cai de <b>12%</b> para <b>4%</b></li>
                <li>Custo de estoque aumenta em <b>R$ 3.000</b></li>
                <li>Vendas adicionais previstas: <b>+180 pe√ßas</b></li>
              </ul>
              <i style='color:#2563eb;'>IA recomenda refor√ßo para a cole√ß√£o Ver√£o 2024, priorizando lojas de alto giro.</i>`
          };
          
          const mensagem = mensagens[modulo] || 'Informa√ß√£o n√£o dispon√≠vel para este m√≥dulo.';
          document.querySelector('.ai-insights-content span').innerHTML = mensagem;
          
          maximizeAiModal();
        };
      });

      // MOCK DE DADOS
      const mockData = {
        kpis: {
          acuracia: 91,
          stockouts: 85,
          economia: 120000
        },
        clusters: [
          { nome: 'Cluster de Produto', demanda: [900, 950, 1000, 1100, 1200], inventario: [1200, 1100, 1050, 1000, 950], historico: [950, 970, 980, 1050, 1150] },
          { nome: 'Cluster A', demanda: [700, 750, 800, 850, 900], inventario: [900, 850, 800, 780, 750], historico: [800, 820, 830, 840, 860] },
          { nome: 'Cluster B', demanda: [500, 520, 540, 560, 580], inventario: [600, 590, 580, 570, 560], historico: [550, 555, 560, 570, 580] }
        ],
        vieses: [
          { gerente: 'Ana', perfil: 'Pessimista', explicacao: 'Tende a superestimar riscos e reduzir proje√ß√µes.', feedback: '' },
          { gerente: 'Jo√£o', perfil: 'Otimista Estrat√©gico', explicacao: 'Foca em oportunidades e metas agressivas.', feedback: '' },
          { gerente: 'Maria', perfil: 'Pessimista', explicacao: 'Conservadora nas previs√µes, evita surpresas.', feedback: '' },
          { gerente: 'Pedro', perfil: 'Otimista', explicacao: 'Acredita em crescimento acima da m√©dia.', feedback: '' }
        ],
        modelos: [
          { nome: 'ARIMA', erro: 320, erroPerc: '5%', explicacao: 'Modelo ARIMA: bom para s√©ries com tend√™ncia e pouca sazonalidade.' },
          { nome: 'GAMLSS', erro: 410, erroPerc: '11%', explicacao: 'Modelo GAMLSS: flex√≠vel para diferentes distribui√ß√µes de erro.' },
          { nome: 'LSTM', erro: 238, erroPerc: '19%', explicacao: 'Modelo LSTM: captura padr√µes n√£o-lineares e depend√™ncias longas.' },
          { nome: 'SARIMA', erro: 350, erroPerc: '8%', explicacao: 'Modelo SARIMA: ideal para s√©ries com forte sazonalidade.' },
          { nome: 'Ca√≥tico', erro: 500, erroPerc: '22%', explicacao: 'Modelo Ca√≥tico: explora padr√µes complexos e imprevis√≠veis.' }
        ],
        ressuprimento: {
          atual: [430, 390, 350, 320],
          otimizado: [300, 320, 310, 300],
          meses: ['Set', 'Out', 'Nov', 'Dez'],
          economia: 35000,
          coberturaIni: 98,
          coberturaFim: 60,
          cluster: 'XY2'
        }
      };

      // Fun√ß√£o para formatar valores
      function formatMoney(v) { return 'R$ ' + (v/1000).toFixed(0) + ' K'; }

      // Preencher KPIs Vis√£o Geral
      document.querySelectorAll('.tab-visao-geral .indicator')[0].querySelector('strong').textContent = mockData.kpis.acuracia + ' %';
      document.querySelectorAll('.tab-visao-geral .indicator')[1].querySelector('strong').textContent = mockData.kpis.stockouts + ' %';
      document.querySelectorAll('.tab-visao-geral .indicator')[2].querySelector('strong').textContent = formatMoney(mockData.kpis.economia);

      // Fun√ß√µes de renderiza√ß√£o
      function renderVieses(tbodySel) {
        const tbody = document.querySelector(tbodySel);
        tbody.innerHTML = '';
        mockData.vieses.forEach(v => {
          tbody.innerHTML += `<tr><td>${v.gerente}</td><td>${v.perfil}</td><td><span class="details-link" data-gerente="${v.gerente}" title="Ver gr√°fico do perfil"><svg width='22' height='22' fill='none' stroke='#2563eb' stroke-width='2' viewBox='0 0 24 24'><circle cx='12' cy='12' r='10'/><path d='M8 16v-4m4 4V8m4 8v-2'/></svg></span></td></tr>`;
        });
      }
      renderVieses('.tab-visao-geral tbody');
      renderVieses('.tab-vieses tbody');

      // Adiciona evento de clique ao √≠cone de gr√°fico para abrir o modal radar
      function bindViesesIconClick() {
        document.querySelectorAll('.details-link[data-gerente]').forEach(el => {
          el.onclick = function(e) {
            e.preventDefault();
            const gerente = this.getAttribute('data-gerente');
            if (typeof openRadarViesesModal === 'function') openRadarViesesModal(gerente);
          };
        });
      }
      bindViesesIconClick();

      // Fun√ß√£o para renderizar o gr√°fico Chart.js de Previs√£o de Demanda
      function renderDemandaChart() {
        const canvas = document.getElementById('demandaChart');
        if (!canvas || canvas.offsetParent === null) return;
        const ctx = canvas.getContext('2d');
        if (window.demandaChartInstance) window.demandaChartInstance.destroy();
        window.demandaChartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
            datasets: [
              { label: 'Prevista', data: [800, 950, 1000, 900, 1100, 1200], borderColor: '#2563eb', backgroundColor: 'rgba(37,99,235,0.08)', tension: 0.4, fill: true },
              { label: 'Estoque', data: [700, 850, 900, 800, 950, 1000], borderColor: '#94a3b8', backgroundColor: 'rgba(148,163,184,0.08)', borderDash: [6,6], tension: 0.4, fill: false }
            ]
          },
          options: { plugins: { legend: { display: true, position: 'bottom' } }, scales: { x: { grid: { display: false } }, y: { beginAtZero: true } } }
        });
      }

      // Inicializa√ß√£o padr√£o
      document.querySelectorAll('.tab-content').forEach(function(tab) {
        if (tab.classList.contains('tab-visao-geral')) {
          tab.style.display = '';
        } else {
          tab.style.display = 'none';
        }
      });

      // Garante que o gr√°fico seja renderizado na primeira carga, se a aba Vis√£o Geral estiver ativa
      window.addEventListener('DOMContentLoaded', function() {
        if (document.querySelector('.tab-visao-geral').style.display !== 'none') {
          setTimeout(renderDemandaChart, 300);
        }
      });

      // Adicionar evento de fechamento ao modal de simula√ß√£o IA
      const modalSimulacaoIA = document.getElementById('modalSimulacaoIA');
      const btnFecharSimulacao = document.getElementById('fecharModalSimulacaoIA');
      const caixaBrancaSimulacao = document.getElementById('modalSimulacaoIABox');

      if (btnFecharSimulacao) {
        btnFecharSimulacao.addEventListener('click', function(e) {
          e.stopPropagation();
          modalSimulacaoIA.style.display = 'none';
        });
      }

      if (modalSimulacaoIA) {
        modalSimulacaoIA.addEventListener('click', function(e) {
          if (e.target === modalSimulacaoIA) {
            modalSimulacaoIA.style.display = 'none';
          }
        });
      }

      if (caixaBrancaSimulacao) {
        caixaBrancaSimulacao.addEventListener('click', function(e) {
          e.stopPropagation();
        });
      }
    });

    // Fun√ß√£o para abrir o modal de detalhes
    function abrirDetalhesModal(conteudoHtml, tipoGrafico, dadosGrafico) {
      document.getElementById('detalhesModalConteudo').innerHTML = conteudoHtml + '<canvas id="modalChart" height="220" style="margin-top:1.5rem;"></canvas>';
      document.getElementById('detalhesModal').style.display = 'flex';
      setTimeout(function() {
        renderModalChart(tipoGrafico, dadosGrafico);
      }, 100);
    }

    // Fun√ß√£o para renderizar o gr√°fico no modal
    function renderModalChart(tipo, dados) {
      const ctx = document.getElementById('modalChart');
      if (!ctx) return;
      if (window.modalChartInstance) window.modalChartInstance.destroy();
      if (tipo === 'linha') {
        window.modalChartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
            datasets: [
              { label: 'Demanda Prevista', data: [800, 950, 1000, 900, 1100, 1200], borderColor: '#2563eb', backgroundColor: 'rgba(37,99,235,0.08)', tension: 0.4, fill: true },
              { label: 'Estoque', data: [700, 850, 900, 800, 950, 1000], borderColor: '#94a3b8', backgroundColor: 'rgba(148,163,184,0.08)', borderDash: [6,6], tension: 0.4, fill: false }
            ]
          },
          options: { plugins: { legend: { display: true, position: 'bottom' } }, scales: { x: { grid: { display: false } }, y: { beginAtZero: true } } }
        });
      } else if (tipo === 'radar') {
        window.modalChartInstance = new Chart(ctx, {
          type: 'radar',
          data: {
            labels: ['Equipe', 'Cluster', 'Previs√£o', 'Erro M√©dio', 'Acima/Abaixo'],
            datasets: [
              { label: 'Perfil Fuzzy', data: dados || [0.7,0.8,0.6,0.9,0.7], backgroundColor: 'rgba(37,99,235,0.18)', borderColor: '#2563eb', pointBackgroundColor: '#2563eb' }
            ]
          },
          options: { plugins: { legend: { display: false } }, scales: { r: { min: 0, max: 1, ticks: { stepSize: 0.2 } } } }
        });
      } else if (tipo === 'barras') {
        window.modalChartInstance = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['A', 'B', 'C', 'D'],
            datasets: [
              { label: 'Distribui√ß√£o', data: [12, 19, 7, 14], backgroundColor: ['#2563eb','#60a5fa','#a3a9b8','#f7b267'] }
            ]
          },
          options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
        });
      }
    }

    // Adicionar eventos aos links 'Ver Detalhes'
    document.querySelectorAll('.details-link').forEach(function(link) {
      link.onclick = function(e) {
        e.preventDefault();
        let conteudo = '';
        let tipoGrafico = 'barras';
        let dadosGrafico = null;
        // Personalize o conte√∫do e gr√°fico conforme a se√ß√£o
        if (this.closest('.demanda-card')) {
          conteudo = `<h2>Detalhes da Previs√£o de Demanda</h2><p>Veja a tend√™ncia da demanda prevista e do estoque para o per√≠odo selecionado.</p>`;
          tipoGrafico = 'linha';
        } else if (this.closest('.card-title') && this.closest('.card-title').textContent.includes('Vieses')) {
          conteudo = `<h2>Detalhes dos Vieses</h2><p>Perfil fuzzy do gerente selecionado, mostrando varia√ß√µes e padr√µes de decis√£o.</p>`;
          tipoGrafico = 'radar';
          // Exemplo: pegar dados do gerente selecionado se dispon√≠vel
          if (window.gerenteSelecionado && window.gerenteSelecionado.radar) {
            dadosGrafico = window.gerenteSelecionado.radar;
          }
        } else {
          conteudo = `<h2>Detalhes</h2><p>Distribui√ß√£o de dados para esta se√ß√£o.</p>`;
          tipoGrafico = 'barras';
        }
        abrirDetalhesModal(conteudo, tipoGrafico, dadosGrafico);
      };
    });

    // Fechar modal ao clicar no X ou fora da caixa
    const modal = document.getElementById('detalhesModal');
    document.getElementById('fecharDetalhesModal').addEventListener('click', function() {
      modal.style.display = 'none';
      // Re-renderiza o gr√°fico principal se a aba Vis√£o Geral estiver ativa
      if (document.querySelector('.tab-visao-geral').style.display !== 'none') {
        setTimeout(renderDemandaChart, 100);
      }
    });
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        modal.style.display = 'none';
        // Re-renderiza o gr√°fico principal se a aba Vis√£o Geral estiver ativa
        if (document.querySelector('.tab-visao-geral').style.display !== 'none') {
          setTimeout(renderDemandaChart, 100);
        }
      }
    });

    // Inst√¢ncias globais dos gr√°ficos
    let chartVisaoGeral = null;
    let chartBarraVisaoGeral = null;
    let chartBarraOtimizacao = null;
    let chartRadarVieses = null;

    function renderGraficoVisaoGeral() {
      const canvas = document.getElementById('graficoVisaoGeral');
      if (!canvas || canvas.offsetParent === null) return;
      if (chartVisaoGeral) chartVisaoGeral.destroy();
      chartVisaoGeral = new Chart(canvas.getContext('2d'), {
        type: 'line',
        data: {
          labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
          datasets: [
            { label: 'Demanda', data: [900, 950, 1000, 1100, 1200, 1250], borderColor: '#2563eb', backgroundColor: 'rgba(37,99,235,0.08)', tension: 0.4, fill: true },
            { label: 'Estoque', data: [1200, 1100, 1050, 1000, 950, 900], borderColor: '#94a3b8', backgroundColor: 'rgba(148,163,184,0.08)', borderDash: [6,6], tension: 0.4, fill: false }
          ]
        },
        options: { plugins: { legend: { display: true, position: 'bottom' } }, scales: { x: { grid: { display: false } }, y: { beginAtZero: true } } }
      });
    }

    function renderGraficoBarraVisaoGeral() {
      const canvas = document.getElementById('graficoBarraVisaoGeral');
      if (!canvas || canvas.offsetParent === null) return;
      if (chartBarraVisaoGeral) chartBarraVisaoGeral.destroy();
      chartBarraVisaoGeral = new Chart(canvas.getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Set', 'Out', 'Nov', 'Dez'],
          datasets: [
            { label: 'Atual', data: [430, 390, 350, 320], backgroundColor: '#5A6A7A' },
            { label: 'Otimizado', data: [300, 320, 310, 300], backgroundColor: '#A3A9B8' }
          ]
        },
        options: { plugins: { legend: { display: true, position: 'bottom' } }, scales: { y: { beginAtZero: true } } }
      });
    }

    function renderGraficoBarraOtimizacao() {
      const canvas = document.getElementById('graficoBarraOtimizacao');
      if (!canvas || canvas.offsetParent === null) return;
      if (chartBarraOtimizacao) chartBarraOtimizacao.destroy();
      chartBarraOtimizacao = new Chart(canvas.getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Set', 'Out', 'Nov', 'Dez'],
          datasets: [
            { label: 'Atual', data: [430, 390, 350, 320], backgroundColor: '#5A6A7A' },
            { label: 'Otimizado', data: [300, 320, 310, 300], backgroundColor: '#A3A9B8' }
          ]
        },
        options: { plugins: { legend: { display: true, position: 'bottom' } }, scales: { y: { beginAtZero: true } } }
      });
    }

    function renderGraficoRadarVieses(valores) {
      const canvas = document.getElementById('graficoRadarVieses');
      if (!canvas || canvas.offsetParent === null) return;
      if (chartRadarVieses) chartRadarVieses.destroy();
      chartRadarVieses = new Chart(canvas.getContext('2d'), {
        type: 'radar',
        data: {
          labels: ['M√©dia da Equipe', 'Varia√ß√£o por Cluster', 'Previs√£o do Cluster', 'Erro Absoluto M√©dio', 'Previs√£o Acima/Abaixo'],
          datasets: [
            { label: 'Perfil', data: valores || [0.7, 0.8, 0.6, 0.9, 0.7], backgroundColor: 'rgba(37,99,235,0.18)', borderColor: '#2563eb', pointBackgroundColor: '#2563eb' }
          ]
        },
        options: { plugins: { legend: { display: false } }, scales: { r: { min: 0, max: 1, ticks: { stepSize: 0.2 } } } }
      });
    }

    // Chamada dos gr√°ficos ao exibir as abas
    function mostrarAba(tab) {
      document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
      document.querySelector('.tab-' + tab).style.display = '';
      setTimeout(() => {
        if (tab === 'visao-geral') {
          renderGraficoVisaoGeral();
          renderGraficoBarraVisaoGeral();
        }
        if (tab === 'otimizacao') {
          renderGraficoBarraOtimizacao();
        }
        if (tab === 'vieses') {
          // Exemplo: valores mockados, pode ser substitu√≠do por dados reais do gerente selecionado
          renderGraficoRadarVieses([0.8, 0.7, 0.9, 0.6, 0.8]);
        }
      }, 300);
    }

    // Substituir navega√ß√£o existente para usar mostrarAba
    const navLinks = document.querySelectorAll('#main-nav a');
    navLinks.forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const tab = this.getAttribute('data-tab');
        navLinks.forEach(l => l.classList.remove('active'));
        this.classList.add('active');
        mostrarAba(tab);
      });
    });

    // Renderizar gr√°ficos na primeira carga se necess√°rio
    window.addEventListener('DOMContentLoaded', function() {
      if (document.querySelector('.tab-visao-geral').style.display !== 'none') {
        setTimeout(() => {
          renderGraficoVisaoGeral();
          renderGraficoBarraVisaoGeral();
        }, 300);
      }
    });

    // Delega√ß√£o de evento para o bot√£o Simular Cen√°rio com IA
    // Garante funcionamento mesmo se o bot√£o for recriado dinamicamente

    document.addEventListener('click', function(e) {
      const btn = e.target.closest('#icone-simular-ia');
      const aiInsightsModal = document.getElementById('aiInsightsModal');
      const aiInsightsContent = aiInsightsModal ? aiInsightsModal.querySelector('.ai-insights-content span') : null;
      if (btn && aiInsightsModal && aiInsightsContent) {
        aiInsightsContent.innerHTML = `
          <b>Simula√ß√£o de Cen√°rio com IA</b><br><br>
          <b>Resultado da Simula√ß√£o:</b><br>
          <ul style='margin:0.7em 0 0.7em 1.2em;'>
            <li>Estoque de acess√≥rios <b>+20%</b></li>
            <li>Risco de ruptura cai de <b>12%</b> para <b>4%</b></li>
            <li>Custo de estoque aumenta em <b>R$ 3.000</b></li>
            <li>Vendas adicionais previstas: <b>+180 pe√ßas</b></li>
          </ul>
          <i style='color:#2563eb;'>IA recomenda refor√ßo para a cole√ß√£o Ver√£o 2024, priorizando lojas de alto giro.</i>
        `;
        if (typeof window.maximizeAiModal === 'function') {
          window.maximizeAiModal();
        } else if (typeof maximizeAiModal === 'function') {
          maximizeAiModal();
        } else {
          aiInsightsModal.classList.remove('minimized');
          aiInsightsModal.style.display = 'flex';
        }
      }
    });
  </script>
</body>
</html> 